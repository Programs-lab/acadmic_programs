<%= render "devise/shared/error_messages", resource: resource %>
<%= render 'shared/card' do%>
<div class="flex flex-wrap px-4" id="user_profile" procedure_types= "<%= resource.procedure_types.select(:id, :procedure_type_name).to_json %>">
  <div class="flex felx-wrap mb-4">
    <div class="w-full">
      <h3>Editar perfil</h3>
  </div>
</div>
<div class="flex flex-wrap w-full">
<div class="w-full px-4 shadow rounded-b py-4 border-t-4 border-primary">

<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, 'v-cloak' => true }, class: "w-full max-w-md") do |f| %>

  <div class="flex w-full rounded">
    <div class="flex w-full justify-center my-3">
      <div class="flex flex-wrap  items-center">
        <div class="flex w-full justify-center items-center">
          <img id="avatar" class="border-2 border-primary block h-32 sm:h-18 md:h-24 lg:h-32 rounded-full mx-auto md:mr-0 sm:mb-0 sm:mr-4 sm:ml-0" src="<%= resource.avatar? ? resource.avatar.thumb.url : gravatar_image_url(resource.email) %>" alt="">
        </div>
        <div class="flex flex-wrap justify-center w-full">
          <div class="flex w-full text-center text-xl font-bold justify-center mt-2">
            <span><%= "#{resource.first_name} #{resource.last_name}" %></span>
          </div>
          <div class="flex w-full text-center text-grey-dark text-xs font-bold justify-center mt-2">
            <span>Edad: <%= age(resource) %></span>
          </div>
          <div class="flex w-full text-center text-grey-dark text-xs font-bold justify-center mt-2">
            <span><%= "#{resource.id_type} #{resource.id_number}" %></span>
          </div>
          <div class="flex w-full justify-center mt-3">
            <label for="user_avatar" class="btn btn-primary text-sm md:text-base">
              <i class="fas fa-cloud-upload-alt"></i> Subir imagen
            </label>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="image-upload" class="flex flex-wrap -mx-3 mb-5">
    <div class="w-1/3 justify-center  px-3 mb-5 md:mb-0 focus_form">
      <%= f.file_field :avatar, autofocus: true, class: "field_input", "@change" => "previewAvatar()" %>
    </div>
  </div>

  <div class="flex flex-wrap w-full mb-0 md:mb-5">
    <div class="w-full md:w-1/2 lg:w-1/2 xl:w-1/2 pr-0 md:pr-2 mb-5 md:mb-0 focus_form">
      <%= f.label :email, class: 'label_input' %><br />
      <%= f.email_field :email, class: 'field_input rounded-t' %>
    </div>
    <div class="w-full md:w-1/2 lg:w-1/2 xl:w-1/2 pl-0 md:pl-2 mb-5 md:mb-0 focus_form">
      <%= f.label 'Dirrecion', class: 'label_input' %><br />
      <%= f.text_field :address, class: 'field_input rounded-t' %>
    </div>
  </div>

  <div class="flex flex-wrap w-full mb-5">
    <div class="w-full md:w-1/2 lg:w-1/2 xl:w-1/2  mb-5 md:mb-0 pr-0 md:pr-2 focus_form">
      <%= f.label 'Afiliado a', class: 'label_input' %>
      <div class="">
        <%= f.collection_select(
           :company_id,
           Company.all,
           :id,
           :company_name,
           { include_blank: true },
           {
             class: "block appearance-none w-full border-b text-grey-darker focus:outline-none bg-white focus:border-grey h-8"
           }
        ) %>
      </div>
    </div>
    <div id= "passwordField" class="w-full md:w-1/2 lg:w-1/2 xl:w-1/2 pl-0 md:pl-2 focus_form">
      <%= f.label "Telefono", class: 'label_input' %>
      <%= f.number_field :phone_number, class: 'field_input rounded-t' %>
    </div>
  </div>



      <% if current_user.patient? %>
        <div class="w-full mb-5 md:mb-0 focus_form">
          <%= f.label "Ocupación", class: 'label_input' %>
          <%= f.text_field :occupation, class: 'field_input rounded-t' %>
      </div>
      <br>
      <% end %>

      <% if resource.doctor? %>
        <div class="w-full md:w-full mb-5 md:mb-0 focus_form">
          <%= f.label :procedimientos, class: 'label_input' %>
          <div class="relative">
            <multiselect v-model="value" value="procedure_types" :options="options" :limit='2' :limit-text="count => `+${count}`" :multiple="true" group-values="procedures" group-label="p_kind" :group-select="true" placeholder=" " track-by="id" label="procedure_type_name" :select-label="' '" :select-group-label="' '" :selected-label="'✓'" :deselect-label= "'✖️'" :deselect-group-label="'✖️'" :close-on-select='false' @input='setProcedureTypes'><span slot="noResult">No se encontraron resultados.</span></multiselect>
          </div>
        </div>
        <div>
          <%= f.hidden_field :procedure_type_ids, "v-model" => "procedure_types"%>
        </div>

        <label class="label_input">
          Firma
        </label>

        <div class="flex w-full mr-2 justify-start">
          <% if resource.signature? %>
            <%= image_tag resource.signature.thumb.url%>
          <% else %>
          <div class="alert alert-warning" role="alert">
            <div class="flex">
              <%= icon('fa', icon_alert['warning'], class: 'mr-3 fa-2x') %>
              <div class="text-teal-darkest w-full">
                <p class="font-bold">Atención.</p>
                <p class="text-sm">Aun no no ha subido su firma, sin esta no sera posible descargar los reportes de citas como PDF</p>
              </div>
            </div>
          </div>
          <% end %>
        </div>
          <div id="image-upload" class="flex flex-wrap -mx-3 mb-5">
            <div class="w-1/3 justify-center  px-3 mb-5 md:mb-0 focus_form">
              <%= f.file_field :signature, autofocus: true, class: "field_input" %>
            </div>
          </div>

      <br>
      <br>
    <% end %>
    <div class="flex justify-end">
      <a class="btn btn-secondary" @click="editPassword = !editPassword">
        <span>Cambiar contraseña </span>
      </a>
    </div>

    <div class="flex flex-wrap -mx-3 mb-6" v-show='editPassword'>
      <div id= "passwordField" class="w-full px-3 focus_form">
        <%= f.label "Contraseña", class: 'label_input' %>
        <%= f.password_field :password, class: 'field_input rounded-t' %>
        <div class="error_form">
          <i class="fas fa-exclamation-circle mr-1"></i>
          <span>Debe tener minimo 8 caracteres.</span>
        </div>
      </div>
    </div>


      <br>

      <div class="md:flex md:items-center justify-end mt-6">
        <div class="flex justify-end w-full lg:w-1/2 xl:w-1/2">
          <div class="justify-between w-auto">
            <%= link_to("Cancelar", root_path, class: "btn btn-secondary no-underline") %>
            <%= f.submit "Actualizar", class: "btn btn-primary" %>
          </div>
        </div>

<% end %>

    </div>
  </div>
</div>
<% end %>
