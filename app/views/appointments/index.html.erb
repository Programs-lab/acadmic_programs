<%= render  'shared/card' do %>
<div id="appointments_index">
  <div class="flex px-4">
    <div class="w-2/3">
    </div>
    <div class="w-1/3 text-right">
    </div>
  </div>
  <div id="medical_record" class="w-full px-4">
    <div class="my-4 flex">
      <div class="w-1/2">
        <h4 class="font-semibold text-g-d4 text-lg">
          Citas
          <br><span class="font-medium text-sm text-g-d2">Listado de citas</span>
        </h4>
      </div>
    </div>
    <div class="flex w-full justify-end">
      <%= link_to new_appointment_path, class: "btn btn-primary" do %>
        <%= icon('fas','plus', class: 'fa-md')%>
      <% end %>
    </div>
    <div class="divider"></div>
    <div class="flex w-full mb-4">
      <span class="font-medium text-sm text-g-d2">Citas por asistir</span>
    </div>
    <% unless @appointments.any? %>
    <div id="flash" class="alert alert-info" role="alert" v-cloak>
      <div class="flex">
        <%= icon('fa', 'info-circle', class: 'mr-3 fa-2x') %>
        <div class="text-teal-darkest w-1/2">
          <p class="font-bold">Atención.</p>
          <p class="text-sm">No tiene citas activas.</p>
        </div>
      </div>
    </div>
    <% end %>
    <% @appointments.each do |appointment| %>
    <div class="flex flex-wrap w-full justify-between mb-2">
      <div class="flex w-1/6 items-center">
        <%= icon('fas','calendar', class: 'fa-md mr-2')%>
        <p><%= l(appointment.appointment_datetime, format: '%d %B %Y') %></p>
      </div>
      <div class="flex w-1/6 items-center">
        <%= icon('fas','clock', class: 'fa-md mr-2')%>
        <%= appointment.appointment_datetime.strftime("%I:%M %P") %>
      </div>
      <div class="flex w-1/6 items-center">
        <%= icon('fas','medkit', class: 'fa-md mr-2')%>
        <p><%= appointment.procedure_type.procedure_type_name%></p>
      </div>
      <div class="flex w-1/6 items-center">
        <%= icon('fas','user-md', class: 'fa-md mr-2')%>
        <p><%= "#{appointment.doctor.first_name} #{appointment.doctor.last_name}"%></p>
      </div>
      <div class="flex w-1/6 justify-center items-center px-8">
        <span class="flex <%= appointment_state(appointment)[1] %> px-2 py-1 mr-3"><%= appointment_state(appointment)[0] %></span>        
      </div>
      <div class="flex w-1/6 justify-end">
        <a id="myBtn" @click="modalId('cancel')" class='btn btn-red-light'>
          <%= icon('fas','calendar-times', "v-ripple" => "'rgba(255, 255, 255, 0.20)'")%>
        </a>
      </div>
    </div>


     <%= form_with url: cancel_appointment_path(appointment_id: appointment.id), method: :put do |form|%>

          <modal-vue i= "cancel" style_modal="width: 45%;">
            <template v-slot:title>
              Cancelar cita
            </template>
            <template v-slot:content>
              <div class="flex flex-wrap mx-auto" style="width: 86.666%;">
                <div class="flex w-full">
                  <p>¿Esta seguro de que desea cancelar esta cita? Esta accion es irreversible</p>
                </div>
                <br>
                <br>
                <div>
                  <%= form.hidden_field :current_user_id, value: current_user.id %>
                </div>
              </div>
            </template>
            <template v-slot:footer>
              <button type="button" name="button" class="btn btn-red-light mx-1" @click="modalId('cancel')">Cancelar</button>
              <%= form.submit "Acceptar", class: 'btn btn-primary' %>
            </template>
          </modal-vue>

      <% end %>


    <% end %>
    <div class="divider"></div>
    <div class="flex w-full mb-4">
      <span class="font-medium text-sm text-g-d2">Historial de citas</span>
    </div>
    <% unless @appointment_history.any? %>
    <div id="" class="alert alert-info" role="alert" v-cloak>
      <div class="flex">
        <%= icon('fa', 'info-circle', class: 'mr-3 fa-2x') %>
        <div class="text-teal-darkest w-1/2">
          <p class="font-bold">Atención.</p>
          <p class="text-sm">No existen citas en su historial medico.</p>
        </div>
      </div>
    </div>
    <% end %>
    <% @appointment_history.each do |appointment| %>
    <div class="flex flex-wrap w-full justify-between mb-2">
      <div class="flex w-1/6 items-center">
        <%= icon('fas','calendar', class: 'fa-md mr-2')%>
        <p><%= l(appointment.appointment_datetime, format: '%d %B %Y') %></p>
      </div>
      <div class="flex w-1/6 items-center">
        <%= icon('fas','clock', class: 'fa-md mr-2')%>
        <%= appointment.appointment_datetime.strftime("%I:%M %P") %>
      </div>
      <div class="flex w-1/6 items-center">
        <%= icon('fas','medkit', class: 'fa-md mr-2')%>
        <p><%= appointment.procedure_type ? appointment.procedure_type.procedure_type_name : "-" %></p>
      </div>
      <div class="flex w-1/6 items-center">
        <%= icon('fas','user-md', class: 'fa-md mr-2')%>
        <p><%= "#{appointment.doctor.first_name} #{appointment.doctor.last_name}"%></p>
      </div>
      <div class="flex w-1/6 justify-center items-center px-8">
        <span class="flex w-full text-sm justify-center <%= appointment_state(appointment)[1] %> py-1"><%= appointment_state(appointment)[0] %></span>        
      </div>
      <div class="flex w-1/6 justify-end">
        <%= link_to "#", class: "btn btn-secondary w-12 text-center mr-1 #{disabled_button(appointment)}" do %>
          <%= icon('fas','info', class: 'fa-md')%>
        <% end %>
      </div>
    </div>
    <% end %>
  </div>
  </div>
</div>
<% end %>
