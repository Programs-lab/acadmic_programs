<%= render  'shared/card' do %>
  <div class="flex px-4">
    <div class="w-2/3">
    </div>
    <div class="w-1/3 text-right">
    </div>
  </div>
  <div id="medical_record" class="w-full px-4" data-medical-record-id="<%= @patient.patient_medical_records.first.id %>" v-cloak>
    <div class="my-4 flex">
      <div class="w-1/2">
        <h4 class="font-semibold text-g-d4 text-lg">
          Paciente
          <br><span class="font-medium text-sm text-g-d2">Datos del paciente</span>
        </h4>
      </div>
    </div>
    <div class="divider">
    </div>
    <div class="row items-center">
      <div class="flex w-1/3 justify-center">
        <img class="img-circle" src="https://www.abeautifulsite.net/uploads/2019/03/cory-nh.jpg?thumbnail=256&key=8a001ba9c3a05010834d053723c48b3cd12c119fc141da08f5a40562d52d1ca0" style="border-radius: 50%; width: 80%; height: 80%;">
      </div>
      <div class="flex w-2/3 justify-center">
          <!-- table heading -->
          <table class="table">
            <tbody>
              <tr>
                <th scope="row">Nombre</th>
                <td><%= "#{@patient.first_name} #{@patient.last_name}" %></td>
              </tr>
              <tr>
                <th scope="row">Telefono</th>
                <td><%= @patient.phone_number %></td>
              </tr>
              <tr>
                <th scope="row">Dirrecion</th>
                <td><%= @patient.address %></td>
              </tr>
              <tr>
                <th scope="row">Edad</th>
                <td>19</td>
              </tr>
              <tr>
                <th scope="row">Afiliado a</th>
                <td><%= @patient.company %></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="divider"></div>
      <%= form_for('medical_record', url: create_medical_record_path(patient_id: @patient.id), method: :post, class: "w-full",
      html: { id: "medical_record_form",
              'appointment' =>  @appointment ? @appointment.to_json(only: [:id, :appointment_datetime]) : {}
      }) do |f| %>
      <div class="flex w-full items-center mb-6">
        <div class="flex w-1/2 justify-start text-grey-darker" v-if="show">
            <%= icon('fas','calendar-day', class:'fa-md mr-2')%>
            <span>{{$moment(appointment.appointment_datetime).format("MMMM Do YYYY")}}</span>

            <%= f.hidden_field :appointment_datetime, ":value" => "appointment.appointment_datetime"%>
            <%= f.hidden_field :appointment_id, ":value" => "appointment.id"%>
            <%= f.hidden_field :doctor_id, value: current_user.id %>
        </div>
        <div class="flex w-full justify-end">
          <div class="flex w-1/5 justify-end text-grey-darker" v-if="show">
              <a class="btn btn-primary" id="myBtn" @click="modalId('1')">
                <%= icon('fas','save', class:'fa-md')%>
              </a>
              <modal-vue i="1" style_modal="width: 80%;">
                <template v-slot:title>
                  <h3>Diagnostico medico</h3>
                </template>
                <template v-slot:content>
                  Esta seguro que desea guardar el diagnostico medico para <%= @patient.first_name %>, recuerde
                  que esta acción es inmodificable.
                </template>
                <template v-slot:footer>
                  <button type="button" name="button" class="btn btn-red-light mx-1" @click="modalId('1')">Cancelar</button>
                  <button type="submit" name="button" class="btn btn-primary">Guardar</button>
                </template>
              </modal-vue>
          </div>
          <div class="flex w-16 justify-end text-grey-darker">
            <a @click="showText">
              <%= icon('fas',"", class: 'btn cursor-pointer fa-md', "v-ripple" => "'rgba(255, 255, 255, 0.20)'", ":class" => "classIconButton")%>
            </a>
          </div>
        </div>
      </div>
      <div id="tab_vue" v-show="show">
        <tab-vue :ids="[1,2,3,4,5,6]">
          <template #1>
            <%= icon('fas','file-alt', class: 'fa-md')%>
            Diagnostico
          </template>
          <template #2>
            <%= icon('fas','list', class: 'fa-md')%>
            Ord Medica
          </template>
          <template #3>
            <%= icon('fas','file', class: 'fa-md')%>
            Sol Examen
          </template>
          <template #4>
            <%= icon('fas','address-book', class: 'fa-md')%>
            Referencias

          </template>
          <template #5>
            <%= icon('fas','wheelchair', class: 'fa-md')%>
            Incapacidad
          </template>
          <template #6>
            <%= icon('fas','upload', class: 'fa-md')%>            
          </template>
          <template #content1>
            <div class="flex w-full border-t-4 border-primary rounded-t">
              <textarea class="flex w-full border-t-4 border-primary rounded-t" name="medical_record[diagnosis]"></textarea>
            </div>
          </template>
          <template #content2>
            <div class="flex w-full border-t-4 border-primary rounded-t">
              <textarea name="medical_record[medical_order]">
                <table class="table" width="100%">
                  <thead>
                    <tr>
                      <th scope="col">Nombre</th>
                      <th scope="col">Posologia</th>
                      <th scope="col">Cantidad</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <td></td>
                      <td></td>
                      <td></td>
                    </tr>
                  </tbody>
                </table>
              </textarea>
            </div>
          </template>
          <template #content3>
            <div class="flex w-full border-t-4 border-primary rounded-t">
              <textarea name="medical_record[examination_request]">
                <table class="table" width="100%">
                  <tbody>
                    <tr>
                      <th scope="row" width="40%">Examen a realizar</th>
                      <td></td>
                    </tr>
                    <tr>
                      <th scope="row">Datos clinicos</th>
                      <td></td>
                    </tr>
                  </tbody>
                </table>
              </textarea>
            </div>
          </template>
          <template #content4>
            <div class="flex w-full border-t-4 border-primary rounded-t">
              <textarea name="medical_record[reference]">
                <table class="table" width="100%">
                  <tbody>
                    <tr>
                      <th scope="row" width="40%">Especialidad a referenciar</th>
                      <td></td>
                    </tr>
                    <tr>
                      <th scope="row">Datos clinicos</th>
                      <td></td>
                    </tr>
                  </tbody>
                </table>
              </textarea>
            </div>
          </template>
          <template #content5>
            <div class="flex w-full border-t-4 border-primary rounded-t">
              <textarea name="medical_record[medical_disability]">
                <table class="table" width="100%">
                  <tbody>
                    <tr>
                      <th scope="row" width="40%">Fecha de inicio de incapacidad</th>
                      <td></td>
                    </tr>
                    <tr>
                      <th scope="row">Dias de incapacidad</th>
                      <td></td>
                    </tr>
                    <tr>
                      <th scope="row">Diagnostico</th>
                      <td></td>
                    </tr>
                    <tr>
                      <th scope="row">Recomendaciones/observaciones</th>
                      <td></td>
                    </tr>
                  </tbody>
                </table>
              </textarea>
            </div>
          </template>
          <template #content6>
            <div class="flex w-full">              
              <vue-dropzone ref="myVueDropzone" v-on:vdropzone-success="" v-on:vdropzone-removed-file="" id="dropzone" :options="dropzoneOptions"></vue-dropzone>
            </div>
          </template>
        </tab-vue>
      </div>
      <% end %>
      <div class="divider"></div>
      <div class="flex w-full justify-end">
        <a class="btn btn-secondary" @click="showFileUpload">
          Carga de archivos
        </a>
        <a class="btn btn-secondary" @click="showMedicalRecord">
          Historial medico
        </a>
      </div>
      <br>
      <div class="" v-show="showM">
        <div class="flex flex-wrap w-full">
          <div class="w-1/2">
            <h4 class="font-semibold text-g-d4 text-lg">
              <span class="font-medium text-sm text-g-d2">Historial medico de Mark</span>
            </h4>
          </div>
        </div>
        <br>
        <div class="row justify-center">
          <% unless @appointment_reports.any? %>
          <div class="alert alert-info w-full" role="alert" v-cloak>
            <div class="flex">
              <%= icon('fa', 'info-circle', class: 'mr-3 fa-2x') %>
              <div class="text-teal-darkest w-1/2">
                <p class="font-bold">Atención.</p>
                <p class="text-sm">Este paciente aun no tiene un historial clínico</p>
              </div>
            </div>
          </div>
          <% end %>
          <% @appointment_reports.each_with_index do |appointment_report, index|%>
            <%= render 'appointment_report', appointment_report: appointment_report, index: index %>
          <% end %>
        </div>
      </div>

      <div class="" v-show="showD">        
          
          <div class="flex w-full">
             <vue-dropzone ref="myVueDropzone" v-on:vdropzone-success="fetchMedia, removeFilesFromDZ()" id="dropzone" :options="dropzoneOptions"></vue-dropzone>
           </div>
           <br>
           <div class="" v-if="media.length > 0">
           <div class="px-0 md:px-4 overflow-auto">
            <table class="table table-responsive">
              <thead>
                <tr>
                  <th width="20%"></th>
                  <th width="30%">Fecha/Hora</th>
                  <th width="50%">Nombre</th>
                </tr>
              </thead>
              <tbody class="">
                <tr v-for="medium in media" track-by="$index">

                  <td>
                    <a v-bind:href="medium.file_name.url" class='btn btn-default btn-xs' target='_blank'>Ver</a>
                    <button type="button" class="btn btn-danger btn-xs" @click=removeMedium(medium.id)>
                        <i class="fa fa-trash"></i>
                    </button>
                  </td>
                  <td>
                    {{$moment(medium.created_at).format('D/M/YYYY h:mm:ss')}}
                  </td>
                  <td>
                    {{medium.file_name.url.split('/')[medium.file_name.url.split('/').length-1]}}
                  </td>

                </tr>
              </tbody>
            </table>
          </div>          
        </div>
        <div class="" v-if="media.length === 0">          
          <div class="flex w-full justify-center">
            <div class="alert alert-info w-full mx-4" role="alert">
              <div class="flex w-full">
                <%= icon('fa', icon_alert['info'], class: 'mr-3 fa-2x') %>
                <div class="text-teal-darkest">
                  <p class="font-bold">Atención.</p>
                  <p class="text-sm">Aun no hay archivos asociados a este paciente, puede usar el campo de carga de archivos para agregar uno</i></p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>



  </div>
<% end %>
